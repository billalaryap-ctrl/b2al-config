<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>B2AL HWID & License Panel</title>

<style>
body{background:#000;color:#fff;font-family:monospace}
.card{background:#0f0f0f;padding:12px;margin:10px;border-radius:12px}
.btn{padding:6px 10px;border-radius:6px;border:0;margin-right:6px}
.green{background:#00d46a}
.red{background:#ff4040}
.blue{background:#1d8bff}
</style>
</head>

<body>

<h2>B2AL HWID & License Panel</h2>
<div id="status">Loading config...</div>
<div id="users"></div>

<script>
const repo = "billalaryap-ctrl/b2al-config";
const file = "config.lua";

async function loadConfig(){

  const res = await fetch(
    `https://raw.githubusercontent.com/${repo}/main/${file}`
  );

  if(!res.ok){
    document.getElementById("status").innerText = "Gagal load config";
    return;
  }

  const text = await res.text();

  // ==== Convert Lua table -> JSON ====
  const lua = text
    .replace(/^return\s*/,'')
    .replace(/--.*$/gm,"")
    .replace(/\s+/g," ")
    .replace(/=/g,":")
    .replace(/([a-zA-Z0-9_]+)\s*:/g,'" $1" :')
    .replace(/'/g,'"')
    .replace(/,(\s*})/g,"$1")
    .replace(/,(\s*])/g,"$1");

  const cfg = JSON.parse(lua);
  window.CONFIG = cfg;

  render(cfg);
}

function render(cfg){

  document.getElementById("status").innerText =
    `Global Expire : ${cfg.global_expire}`;

  const box = document.getElementById("users");
  box.innerHTML = "";

  if(!cfg.users || cfg.users.length === 0){
    box.innerHTML = "<p>Tidak ada user.</p>";
    return;
  }

  cfg.users.forEach((u,i)=>{

    box.innerHTML += `
      <div class="card">
        User  : ${u.user}<br>
        Expire: ${u.expire}<br>
        HWID  : ${u.hwid || "(kosong / siap daftar)"}<br>
        Status: ${u.ban ? "BANNED" : "ACTIVE"}<br><br>

        <button class="btn green" onclick="resetHWID(${i})">Reset HWID</button>
        <button class="btn red" onclick="toggleBan(${i})">
          ${u.ban ? "Unban" : "Ban"}
        </button>
        <button class="btn blue" onclick="extend(${i})">Extend</button>
      </div>
    `;
  });
}

loadConfig();
</script>

</body>
</html>
