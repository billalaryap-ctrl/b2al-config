<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>B2AL HWID & License Panel</title>

<style>
body{
  background:#0d0d0d;
  color:#fff;
  font-family:monospace;
}
.box{
  background:#111;
  padding:15px;
  margin:10px;
  border-radius:10px;
}
.btn{padding:7px 12px;border-radius:7px;border:0}
.green{background:#1dd75b}
.red{background:#ff4444}
.blue{background:#1d9cff}
</style>

</head>
<body>

<h2>B2AL HWID & License Panel</h2>
Repo: b2al-config
<br><br>

<div id="status">Memuat data...</div>
<div id="users"></div>

<script>

const repo = "billalaryap-ctrl/b2al-config";
const filePath = "config.json";

let CONFIG = null;

// =========================
// FETCH CONFIG.JSON
// =========================
async function fetchConfig(){
  try{
    const res = await fetch(
      `https://raw.githubusercontent.com/${repo}/main/${filePath}`
    );

    CONFIG = await res.json();

    document.getElementById("status").innerHTML =
      `Global Expire: ${CONFIG.global_expire}`;

    renderUsers();

  }catch(e){
    document.getElementById("status").innerHTML =
      "‚ùå Gagal load config";
  }
}

// =========================
// RENDER USER LIST
// =========================
function renderUsers(){

  const box = document.getElementById("users");
  box.innerHTML = "";

  if(!CONFIG.users || CONFIG.users.length === 0){
    box.innerHTML = "<p>Tidak ada user ditemukan</p>";
    return;
  }

  CONFIG.users.forEach((u,i)=>{

    box.innerHTML += `
      <div class="box">
        <b>User:</b> ${u.user}<br>
        <b>Expire:</b> ${u.expire}<br>
        <b>HWID:</b> ${u.hwid || "(kosong / siap daftar)"}<br>
        <b>Status:</b> ${u.ban ? "üö´ BANNED" : "üü¢ ACTIVE"}<br><br>

        <button class="btn green" onclick="resetHWID(${i})">Reset HWID</button>
        <button class="btn red" onclick="toggleBan(${i})">
          ${u.ban ? "Unban" : "Ban"}
        </button>
        <button class="btn blue" onclick="extend(${i})">Extend</button>
      </div>
    `;
  });
}

// =========================
// EDIT ACTIONS
// =========================
function resetHWID(i){
  CONFIG.users[i].hwid = "";
  alert("HWID direset");
  pushUpdate();
}

function toggleBan(i){
  CONFIG.users[i].ban = !CONFIG.users[i].ban;
  pushUpdate();
}

function extend(i){
  const tgl = prompt("Masukkan tanggal baru (YYYY-MM-DD):",
                     CONFIG.users[i].expire);

  if(!tgl) return;

  CONFIG.users[i].expire = tgl;
  pushUpdate();
}

// =========================
// UPDATE FILE KE GITHUB
// =========================
async function pushUpdate(){

  const token = prompt("Masukkan GitHub Token:");

  if(!token){
    alert("Token wajib diisi");
    return;
  }

  // ambil SHA file lama
  const metaReq = await fetch(
    `https://api.github.com/repos/${repo}/contents/${filePath}`
  );
  const meta = await metaReq.json();

  // encode JSON
  const body = btoa(JSON.stringify(CONFIG,null,2));

  // push
  await fetch(
    `https://api.github.com/repos/${repo}/contents/${filePath}`,
    {
      method:"PUT",
      headers:{Authorization:`Bearer ${token}`},
      body:JSON.stringify({
        message:"Panel update",
        content:body,
        sha:meta.sha
      })
    }
  );

  alert("‚úîÔ∏è Config berhasil disimpan");
  fetchConfig();
}

fetchConfig();

</script>

</body>
</html>
